<?php


$d8_nodes[8754] = array(
  array(

    "field_ipu_event_document_widget"=>"2579",

    "field_event_document" => array(   "fid"=>4895,
    ),
  ),
);

$d8_nodes[8755] = array(
  array(

    "field_ipu_event_document_widget"=>"2594",

    "field_event_document" => array(   "fid"=>4898,
    ),
  ),
);

$d8_nodes[8762] = array(
  array(

    "field_ie_fc_description"=>"&lt;p&gt;&lt;a href=&quot;http://www.secretariagrulacuip.org/web/&quot; target=&quot;_blank&quot;&gt;Documents in Spanish (the translation is the responsibility of the GRULAC Secretariat) / Documentos en español (La traducción es responsabilidad de la Secretaría del GRULAC)&lt;/a&gt;&lt;/p&gt;
",
    "field_ipu_event_document_widget"=>"2490",

    "field_event_document" => array(   "fid"=>4465,
    ),
  ),
);

$d8_nodes[8763] = array(
  array(

    "field_ie_fc_description"=>"&lt;p&gt;&lt;a href=&quot;http://www.secretariagrulacuip.org/web/&quot; target=&quot;_blank&quot;&gt;Documents en espagnol (traduction sous la reponsabilité du Secretariat du GRULAC) / Documentos en español (La traducción es responsabilidad de la Secretaría del GRULAC)&lt;/a&gt;&lt;/p&gt;
",
    "field_ipu_event_document_widget"=>"3021",

    "field_event_document" => array(   "fid"=>4466,
    ),
  ),
);

$d8_nodes[8764] = array(
  array(

    "field_ipu_event_document_widget"=>"2855",

    "field_event_document" => array(   "fid"=>4979,
    ),
  ),
);

$d8_nodes[8765] = array(
  array(

    "field_ipu_event_document_widget"=>"2873",

    "field_event_document" => array(   "fid"=>4980,
    ),
  ),
);

$d8_nodes[8770] = array(
  array(

    "field_ipu_event_document_widget"=>"2163",

    "field_event_document" => array(   "fid"=>5138,
    ),
  ),
);

$d8_nodes[8771] = array(
  array(

    "field_ipu_event_document_widget"=>"2169",

    "field_event_document" => array(   "fid"=>5139,
    ),
  ),
);

$d8_nodes[9149] = array(
  array(

    "field_ipu_event_document_widget"=>"2787",

    "field_event_document" => array(   "fid"=>4392,
    ),
  ),
);

$d8_nodes[9151] = array(
  array(

    "field_ipu_event_document_widget"=>"3373",

    "field_event_document" => array(   "fid"=>4920,
    ),
  ),
);

$d8_nodes[9154] = array(
  array(

    "field_ipu_event_document_widget"=>"3447",

    "field_event_document" => array(   "fid"=>4996,
    ),
  ),
);

$d8_nodes[9155] = array(
  array(

    "field_ipu_event_document_widget"=>"3473",
  ),
);

$d8_nodes[9156] = array(
  array(

    "field_ipu_event_document_widget"=>"3485",

    "field_event_document" => array(   "fid"=>6032,
    ),
  ),
);

$d8_nodes[9157] = array(
  array(

    "field_ipu_event_document_widget"=>"4295",

    "field_event_document" => array(   "fid"=>5483,
    ),
  ),
);

$d8_nodes[9158] = array(
  array(

    "field_ipu_event_document_widget"=>"4365",

    "field_event_document" => array(   "fid"=>5597,
    ),
  ),
);

$d8_nodes[9159] = array(
  array(

    "field_ipu_event_document_widget"=>"4082",

    "field_event_document" => array(   "fid"=>5326,
    ),
  ),
);

$d8_nodes[9160] = array(
  array(

    "field_ipu_event_document_widget"=>"4174",

    "field_event_document" => array(   "fid"=>5922,
    ),
  ),
);

$d8_nodes[9166] = array(
  array(

    "field_ipu_event_document_widget"=>"4208",

    "field_event_document" => array(   "fid"=>5456,
    ),
  ),
);

$d8_nodes[9170] = array(
  array(

    "field_ipu_event_document_widget"=>"3877",

    "field_event_document" => array(   "fid"=>5434,
    ),
  ),
);

$d8_nodes[9171] = array(
  array(

    "field_ipu_event_document_widget"=>"4664",

    "field_event_document" => array(   "fid"=>6228,
    ),
  ),
);

$d8_nodes[9174] = array(
  array(

    "field_ipu_event_document_widget"=>"4694",

    "field_event_document" => array(   "fid"=>6229,
    ),
  ),
);

$d8_nodes[9175] = array(
  array(

    "field_ipu_event_document_widget"=>"3882",

    "field_event_document" => array(   "fid"=>5438,
    ),
  ),
);

$d8_nodes[9179] = array(
  array(

    "field_ipu_event_document_widget"=>"4236",

    "field_event_document" => array(   "fid"=>5459,
    ),
  ),
);

$d8_nodes[9185] = array(
  array(

    "field_ipu_event_document_widget"=>"4181",

    "field_event_document" => array(   "fid"=>5923,
    ),
  ),
);

$d8_nodes[9188] = array(
  array(

    "field_ipu_event_document_widget"=>"4306",

    "field_event_document" => array(   "fid"=>5489,
    ),
  ),
);

$d8_nodes[9189] = array(
  array(

    "field_ipu_event_document_widget"=>"3490",

    "field_event_document" => array(   "fid"=>6033,
    ),
  ),
);

$d8_nodes[9190] = array(
  array(

    "field_ipu_event_document_widget"=>"3478",
  ),
);

$d8_nodes[9191] = array(
  array(

    "field_ipu_event_document_widget"=>"3452",

    "field_event_document" => array(   "fid"=>4997,
    ),
  ),
);

$d8_nodes[9194] = array(
  array(

    "field_ipu_event_document_widget"=>"3376",

    "field_event_document" => array(   "fid"=>4921,
    ),
  ),
);

$d8_nodes[9196] = array(
  array(

    "field_ipu_event_document_widget"=>"2793",

    "field_event_document" => array(   "fid"=>4393,
    ),
  ),
);

$d8_nodes[9223] = array(
  array(

    "field_ipu_event_document_widget"=>"3129",

    "field_event_document" => array(   "fid"=>5130,
    ),
  ),
);

$d8_nodes[9290] = array(
  array(

    "field_ipu_event_document_widget"=>"2937",
  ),
);

$d8_nodes[9296] = array(
  array(

    "field_ipu_event_document_widget"=>"2971",
  ),
);

$d8_nodes[9453] = array(
  array(

    "field_ipu_event_document_widget"=>"3191",

    "field_event_document" => array(   "fid"=>4832,
    ),
  ),
);

$d8_nodes[9454] = array(
  array(

    "field_ipu_event_document_widget"=>"3198",

    "field_event_document" => array(   "fid"=>4854,
    ),
  ),
);

$d8_nodes[9480] = array(
  array(

    "field_ipu_event_document_widget"=>"3962",

    "field_event_document" => array(   "fid"=>5202,
    ),
  ),
);

$d8_nodes[9482] = array(
  array(

    "field_ipu_event_document_widget"=>"3455",

    "field_event_document" => array(   "fid"=>5762,
    ),
  ),
);

$d8_nodes[9483] = array(
  array(

    "field_ipu_event_document_widget"=>"3461",

    "field_event_document" => array(   "fid"=>5763,
    ),
  ),
);

$d8_nodes[9484] = array(
  array(

    "field_ipu_event_document_widget"=>"3904",

    "field_event_document" => array(   "fid"=>5829,
    ),
  ),
);

$d8_nodes[9485] = array(
  array(

    "field_ipu_event_document_widget"=>"4612",

    "field_event_document" => array(   "fid"=>5830,
    ),
  ),
);

$d8_nodes[9486] = array(
  array(

    "field_ipu_event_document_widget"=>"3979",

    "field_event_document" => array(   "fid"=>5938,
    ),
  ),
);

$d8_nodes[9487] = array(
  array(

    "field_ipu_event_document_widget"=>"3983",

    "field_event_document" => array(   "fid"=>5939,
    ),
  ),
);

$d8_nodes[9490] = array(
  array(

    "field_ipu_event_document_widget"=>"4542",

    "field_event_document" => array(   "fid"=>5798,
    ),
  ),
);

$d8_nodes[9491] = array(
  array(

    "field_ipu_event_document_widget"=>"4554",

    "field_event_document" => array(   "fid"=>5789,
    ),
  ),
);

$d8_nodes[9549] = array(
  array(

    "field_ipu_event_document_widget"=>"3798",

    "field_event_document" => array(   "fid"=>5131,
    ),
  ),
);

$d8_nodes[9553] = array(
  array(

    "field_ipu_event_document_widget"=>"3850",

    "field_event_document" => array(   "fid"=>5145,
    ),
  ),
);

$d8_nodes[9560] = array(
  array(

    "field_ipu_event_document_widget"=>"3916",

    "field_event_document" => array(   "fid"=>5194,
    ),
  ),
);

$d8_nodes[9561] = array(
  array(

    "field_ipu_event_document_widget"=>"3927",

    "field_event_document" => array(   "fid"=>5196,
    ),
  ),
);

$d8_nodes[9562] = array(
  array(

    "field_ipu_event_document_widget"=>"4065",

    "field_event_document" => array(   "fid"=>5320,
    ),
  ),
);

$d8_nodes[9563] = array(
  array(

    "field_ipu_event_document_widget"=>"4070",

    "field_event_document" => array(   "fid"=>5321,
    ),
  ),
);

$d8_nodes[9721] = array(
  array(

    "field_ipu_event_document_widget"=>"4627",

    "field_event_document" => array(   "fid"=>5845,
    ),
  ),
);

$d8_nodes[9722] = array(
  array(

    "field_ipu_event_document_widget"=>"4631",

    "field_event_document" => array(   "fid"=>5847,
    ),
  ),
);

$d8_nodes[9727] = array(
  array(

    "field_ipu_event_document_widget"=>"4725",

    "field_event_document" => array(   "fid"=>6269,
    ),
  ),
);

$d8_nodes[9728] = array(
  array(

    "field_ipu_event_document_widget"=>"4732",

    "field_event_document" => array(   "fid"=>6270,
    ),
  ),
);

/******************************/

$paragraph_type = 'ipu_event_section';
$node_field = 'field_ipu_event_section';


use Drupal\paragraphs\Entity\Paragraph;  // Don't forget to use a little Class...
use Drupal\node\Entity\Node;


$counter = 0;

foreach($d8_nodes as $node_id=>$new_paragraphs) {

   # debug($node_id);
  #  debug($new_paragraphs);
  #  continue;

  $node = Node::load($node_id);

  if (empty($node)) {
    print_r("\rcontinuing ... ");
    continue;
  }
  else {
    print_r("\rnode fine ...");
  }


$counter = 0;

// now create the child and grandchild paragraphs
  foreach($new_paragraphs as $new_paragraph) {

#    print_r($new_paragraph);
    $paragraph_ipu_event_document = '';


      if (!empty($new_paragraph['field_event_document'])) { // create the grandchild
        $paragraph_ipu_event_document = Paragraph::create(['type' => 'ipu_event_document',]);
        print_r(' saving a file ');
        print_r($new_paragraph['field_event_document']['fid']); // there's only one file, no need to loop
        $file = file_load($new_paragraph['field_event_document']['fid']); // there's only one file, no need to loop
        $paragraph_ipu_event_document->set('field_event_document', $file);

        $paragraph_ipu_event_document->isNew();
        $paragraph_ipu_event_document->save();
      }
      else {
        print_r(' no document to save ');
      }

      // create child
      $paragraph_ipu_event_document_widget = Paragraph::create(['type' => 'ipu_event_document_widget',]);

      // attach grandchild to child
      if(!empty($paragraph_ipu_event_document)) {
        $paragraph_ipu_event_document_widget->field_ipu_event_document->appendItem($paragraph_ipu_event_document);
      }

      $paragraph_ipu_event_document_widget->isNew();
      $paragraph_ipu_event_document_widget->save();


      $paragraph = Paragraph::create(['type' => 'ipu_event_section',]);

      $paragraph->field_ipu_event_document_widget->appendItem($paragraph_ipu_event_document_widget);

      ### LONG TEXT TEMPLATE
      if (!empty($new_paragraph['field_ie_fc_description'])) {
        $paragraph->set('field_ie_fc_description', ['value' => htmlspecialchars_decode($new_paragraph['field_ie_fc_description']),'format'=>'full_html']);
      }

      $paragraph->isNew();
      $paragraph->save();



     ### TAXONOMY RELATION TEMPLATE
//         if (!empty($new_paragraph['field_ipu_event_sponsor_name'])) {
//            $paragraph->set('field_ipu_event_sponsor_name', $new_paragraph['field_ipu_event_sponsor_name']);
//         }
//         else {
//           continue; // if no title, don't save...
//         }

     ### TEXT TEMPLATE
     //    if (!empty($new_paragraph['field_fc_session_type_title'])) {
     //      $paragraph->set('field_fc_session_type_title', ['value' => htmlspecialchars_decode($new_paragraph['field_fc_session_type_title'])]);
     //    }
     ////    else {
     ////      continue; // if no title, don't save...
     ////    }

     ### BOOLEAN TEMPLATE
     //    if (!empty($new_paragraph['field_fc_session_closed_session'])) {
     //      $paragraph->set('field_fc_session_closed_session', ['value' => $new_paragraph['field_fc_session_closed_session']]);
     //    }
     //    else {
     //      $paragraph->set('field_fc_session_closed_session', ['value' => 0]);
     //    }

     ### LINK TEMPLATE
     //    if (!empty($new_paragraph['field_external_link'])) {
     //      $paragraph->set('field_external_link',
     //        ["uri" => htmlspecialchars_decode($new_paragraph['field_external_link']['uri']),
     //          "title" => htmlspecialchars_decode($new_paragraph['field_external_link']['title']),
     //        ]
     //      );
     //
     //     # debug($new_paragraph['field_related_link']['title']);
     //    }

    ### LONG TEXT TEMPLATE
     //    if (!empty($new_paragraph['field_event_document_description'])) {
     //      $paragraph->set('field_event_document_description', ['value' => htmlspecialchars_decode($new_paragraph['field_event_document_description']),'format'=>'full_html']);
     //    }

     if(!empty($paragraph) && ! is_null($paragraph)) {

       $node->{$node_field}->appendItem($paragraph);

     }
     //    if(!empty($node)) {
     #      $node->set($node_field, []); // remove all paras from this node
     #      $node->save();
     //    }

     $counter++;
  }

  print("\n - saved node $node->id \n");

  $node->save();
}


print("\n - saved $counter paragraphs");
