<?php


$d8_nodes[8754] = array(
  array(

    "field_ipu_event_document_widget"=>"2579",

    "field_event_document" => array(   "fid"=>4895,
    ),
  ),
);

$d8_nodes[8755] = array(
  array(

    "field_ipu_event_document_widget"=>"2594",

    "field_event_document" => array(   "fid"=>4898,
    ),
  ),
);

$d8_nodes[8762] = array(
  array(

    "field_ie_fc_description"=>"&lt;p&gt;&lt;a href=&quot;http://www.secretariagrulacuip.org/web/&quot; target=&quot;_blank&quot;&gt;Documents in Spanish (the translation is the responsibility of the GRULAC Secretariat) / Documentos en español (La traducción es responsabilidad de la Secretaría del GRULAC)&lt;/a&gt;&lt;/p&gt;
",
    "field_ipu_event_document_widget"=>"2490",

    "field_event_document" => array(   "fid"=>4465,
    ),
  ),
);

$d8_nodes[8763] = array(
  array(

    "field_ie_fc_description"=>"&lt;p&gt;&lt;a href=&quot;http://www.secretariagrulacuip.org/web/&quot; target=&quot;_blank&quot;&gt;Documents en espagnol (traduction sous la reponsabilité du Secretariat du GRULAC) / Documentos en español (La traducción es responsabilidad de la Secretaría del GRULAC)&lt;/a&gt;&lt;/p&gt;
",
    "field_ipu_event_document_widget"=>"3021",

    "field_event_document" => array(   "fid"=>4466,
    ),
  ),
);

$d8_nodes[8764] = array(
  array(

    "field_ipu_event_document_widget"=>"2855",

    "field_event_document" => array(   "fid"=>4979,
    ),
  ),
);

$d8_nodes[8765] = array(
  array(

    "field_ipu_event_document_widget"=>"2873",

    "field_event_document" => array(   "fid"=>4980,
    ),
  ),
);

$d8_nodes[8770] = array(
  array(

    "field_ipu_event_document_widget"=>"2163",

    "field_event_document" => array(   "fid"=>5138,
    ),
  ),
);

$d8_nodes[8771] = array(
  array(

    "field_ipu_event_document_widget"=>"2169",

    "field_event_document" => array(   "fid"=>5139,
    ),
  ),
);

$d8_nodes[9149] = array(
  array(

    "field_ipu_event_document_widget"=>"2787",

    "field_event_document" => array(   "fid"=>4392,
    ),
  ),
);

$d8_nodes[9151] = array(
  array(

    "field_ipu_event_document_widget"=>"3373",

    "field_event_document" => array(   "fid"=>4920,
    ),
  ),
);

$d8_nodes[9154] = array(
  array(

    "field_ipu_event_document_widget"=>"3447",

    "field_event_document" => array(   "fid"=>4996,
    ),
  ),
);

$d8_nodes[9155] = array(
  array(

    "field_ipu_event_document_widget"=>"3473",
  ),
);

$d8_nodes[9156] = array(
  array(

    "field_ipu_event_document_widget"=>"3485",

    "field_event_document" => array(   "fid"=>6032,
    ),
  ),
);

$d8_nodes[9157] = array(
  array(

    "field_ipu_event_document_widget"=>"4295",

    "field_event_document" => array(   "fid"=>5483,
    ),
  ),
);

$d8_nodes[9158] = array(
  array(

    "field_ipu_event_document_widget"=>"4365",

    "field_event_document" => array(   "fid"=>5597,
    ),
  ),
);

$d8_nodes[9159] = array(
  array(

    "field_ipu_event_document_widget"=>"4082",

    "field_event_document" => array(   "fid"=>5326,
    ),
  ),
);

$d8_nodes[9160] = array(
  array(

    "field_ipu_event_document_widget"=>"4174",

    "field_event_document" => array(   "fid"=>5922,
    ),
  ),
);

$d8_nodes[9166] = array(
  array(

    "field_ipu_event_document_widget"=>"4208",

    "field_event_document" => array(   "fid"=>5456,
    ),
  ),
);

$d8_nodes[9170] = array(
  array(

    "field_ipu_event_document_widget"=>"3877",

    "field_event_document" => array(   "fid"=>5434,
    ),
  ),
);

$d8_nodes[9171] = array(
  array(

    "field_ipu_event_document_widget"=>"4664",

    "field_event_document" => array(   "fid"=>6228,
    ),
  ),
);

$d8_nodes[9174] = array(
  array(

    "field_ipu_event_document_widget"=>"4694",

    "field_event_document" => array(   "fid"=>6229,
    ),
  ),
);

$d8_nodes[9175] = array(
  array(

    "field_ipu_event_document_widget"=>"3882",

    "field_event_document" => array(   "fid"=>5438,
    ),
  ),
);

$d8_nodes[9179] = array(
  array(

    "field_ipu_event_document_widget"=>"4236",

    "field_event_document" => array(   "fid"=>5459,
    ),
  ),
);

$d8_nodes[9185] = array(
  array(

    "field_ipu_event_document_widget"=>"4181",

    "field_event_document" => array(   "fid"=>5923,
    ),
  ),
);

$d8_nodes[9188] = array(
  array(

    "field_ipu_event_document_widget"=>"4306",

    "field_event_document" => array(   "fid"=>5489,
    ),
  ),
);

$d8_nodes[9189] = array(
  array(

    "field_ipu_event_document_widget"=>"3490",

    "field_event_document" => array(   "fid"=>6033,
    ),
  ),
);

$d8_nodes[9190] = array(
  array(

    "field_ipu_event_document_widget"=>"3478",
  ),
);

$d8_nodes[9191] = array(
  array(

    "field_ipu_event_document_widget"=>"3452",

    "field_event_document" => array(   "fid"=>4997,
    ),
  ),
);

$d8_nodes[9194] = array(
  array(

    "field_ipu_event_document_widget"=>"3376",

    "field_event_document" => array(   "fid"=>4921,
    ),
  ),
);

$d8_nodes[9196] = array(
  array(

    "field_ipu_event_document_widget"=>"2793",

    "field_event_document" => array(   "fid"=>4393,
    ),
  ),
);

$d8_nodes[9223] = array(
  array(

    "field_ipu_event_document_widget"=>"3129",

    "field_event_document" => array(   "fid"=>5130,
    ),
  ),
);

$d8_nodes[9290] = array(
  array(

    "field_ipu_event_document_widget"=>"2937",
  ),
);

$d8_nodes[9296] = array(
  array(

    "field_ipu_event_document_widget"=>"2971",
  ),
);

$d8_nodes[9453] = array(
  array(

    "field_ipu_event_document_widget"=>"3191",

    "field_event_document" => array(   "fid"=>4832,
    ),
  ),
);

$d8_nodes[9454] = array(
  array(

    "field_ipu_event_document_widget"=>"3198",

    "field_event_document" => array(   "fid"=>4854,
    ),
  ),
);

$d8_nodes[9480] = array(
  array(

    "field_ipu_event_document_widget"=>"3962",

    "field_event_document" => array(   "fid"=>5202,
    ),
  ),
);

$d8_nodes[9482] = array(
  array(

    "field_ipu_event_document_widget"=>"3455",

    "field_event_document" => array(   "fid"=>5762,
    ),
  ),
);

$d8_nodes[9483] = array(
  array(

    "field_ipu_event_document_widget"=>"3461",

    "field_event_document" => array(   "fid"=>5763,
    ),
  ),
);

$d8_nodes[9484] = array(
  array(

    "field_ipu_event_document_widget"=>"3904",

    "field_event_document" => array(   "fid"=>5829,
    ),
  ),
);

$d8_nodes[9485] = array(
  array(

    "field_ipu_event_document_widget"=>"4612",

    "field_event_document" => array(   "fid"=>5830,
    ),
  ),
);

$d8_nodes[9486] = array(
  array(

    "field_ipu_event_document_widget"=>"3979",

    "field_event_document" => array(   "fid"=>5938,
    ),
  ),
);

$d8_nodes[9487] = array(
  array(

    "field_ipu_event_document_widget"=>"3983",

    "field_event_document" => array(   "fid"=>5939,
    ),
  ),
);

$d8_nodes[9490] = array(
  array(

    "field_ipu_event_document_widget"=>"4542",

    "field_event_document" => array(   "fid"=>5798,
    ),
  ),
);

$d8_nodes[9491] = array(
  array(

    "field_ipu_event_document_widget"=>"4554",

    "field_event_document" => array(   "fid"=>5789,
    ),
  ),
);

$d8_nodes[9549] = array(
  array(

    "field_ipu_event_document_widget"=>"3798",

    "field_event_document" => array(   "fid"=>5131,
    ),
  ),
);

$d8_nodes[9553] = array(
  array(

    "field_ipu_event_document_widget"=>"3850",

    "field_event_document" => array(   "fid"=>5145,
    ),
  ),
);

$d8_nodes[9560] = array(
  array(

    "field_ipu_event_document_widget"=>"3916",

    "field_event_document" => array(   "fid"=>5194,
    ),
  ),
);

$d8_nodes[9561] = array(
  array(

    "field_ipu_event_document_widget"=>"3927",

    "field_event_document" => array(   "fid"=>5196,
    ),
  ),
);

$d8_nodes[9562] = array(
  array(

    "field_ipu_event_document_widget"=>"4065",

    "field_event_document" => array(   "fid"=>5320,
    ),
  ),
);

$d8_nodes[9563] = array(
  array(

    "field_ipu_event_document_widget"=>"4070",

    "field_event_document" => array(   "fid"=>5321,
    ),
  ),
);

$d8_nodes[9721] = array(
  array(

    "field_ipu_event_document_widget"=>"4627",

    "field_event_document" => array(   "fid"=>5845,
    ),
  ),
);

$d8_nodes[9722] = array(
  array(

    "field_ipu_event_document_widget"=>"4631",

    "field_event_document" => array(   "fid"=>5847,
    ),
  ),
);

$d8_nodes[9727] = array(
  array(

    "field_ipu_event_document_widget"=>"4725",

    "field_event_document" => array(   "fid"=>6269,
    ),
  ),
);

$d8_nodes[9728] = array(
  array(

    "field_ipu_event_document_widget"=>"4732",

    "field_event_document" => array(   "fid"=>6270,
    ),
  ),
);

/******************************/

$paragraph_type = 'ipu_event_section';
$node_field = 'field_ipu_event_section';


use Drupal\paragraphs\Entity\Paragraph;  // Don't forget to use a little Class...
use Drupal\node\Entity\Node;


$counter = 0;
$fc_to_para_mapping = get_fc_to_para_mapping();
//print_r($fc_to_para_mapping);

foreach($d8_nodes as $node_id=>$new_paragraphs) {

  $node = Node::load($node_id);

  if (!empty($node)) {
    print("\n - Process node $node_id \n");
    $ns = $node->toArray();
    print "\nNode has".print_r($ns['field_ipu_event_section'],true). "\n";

    foreach ($new_paragraphs as $new_paragraph) {
      $fc_id = $new_paragraph['field_ipu_event_document_widget'];
      //print "\nWas " . $fc_id . " now is ";
      $pid = $fc_to_para_mapping[$fc_id];
      //print $pid . "\n";
      //$paragraph->set('field_fc_session_type', $new_paragraph['field_fc_session_type']);
      $p = entity_load('paragraph', $pid);
      if (!empty($p)) {
        $paras = $p->toArray();
        //print_r($paras);
        $revision_id = $paras['revision_id'][0]['value'];
        $node->field_ipu_event_section[]= [
            'target_id' => $pid,
            'target_revision_id' => $revision_id
        ];
      }
      $ns = $node->toArray();
      print_r($ns['field_ipu_event_section']);
      $node->save();
      print("\n - saved node $node->id \n");
    }
  }
}

function get_fc_to_para_mapping() {
  $fc_to_para_mapping = [];
  $pids = \Drupal::entityQuery('paragraph')
    //->condition('id', 14190)
    ->condition('type', ['ipu_event_section'], 'IN')
    ->execute();
  $paragraphs = entity_load_multiple('paragraph', $pids, TRUE);
  foreach ($paragraphs as $pid => $paragraph) {
    $paras = $paragraph->toArray();
    $pid = $paras['id'][0]['value'];
    foreach ($paras as $y => $field_fc_original_reference) {
      if ($y == "field_fc_original_reference") {
        //print "$y:\n". print_r($field_fc_original_reference, true)."\n";
        foreach ($field_fc_original_reference as $target_fc_id) {
          $fc_to_para_mapping[$target_fc_id['value']] = $pid;
        }
      }
    }
  }
  print("We have " . count($fc_to_para_mapping) . " mappings\n");
  return $fc_to_para_mapping;
}